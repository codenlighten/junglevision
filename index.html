<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<!-- favicon.png -->
		<link rel="icon" href="favicon.png" />
		<!-- twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@junglevision" />
		<meta name="twitter:creator" content="@junglevision" />
		<meta name="twitter:title" content="Jungle Vision" />
		<meta
			name="twitter:description"
			content="View transaction details on the BSV Blockchain with Jungle Bus"
		/>
		<meta name="twitter:image" content="https://junglevision.online/logo.png" />

		<script src="https://unpkg.com/bsv@1.5"></script>
		<title>Jungle Vision</title>
		<style>
			* {
				box-sizing: border-box;
			}

			body {
				font-family: "Courier New", Courier, monospace;
				margin: 0;
				padding: 0;
				word-wrap: break-word;
				background-color: #191919;
			}

			.container {
				margin: 0 auto;
				max-width: 800px;
				padding: 1rem;
				background-color: #eee;
			}

			#header {
				text-align: center;
			}

			#form {
				text-align: center;
			}

			#result {
				background-color: #eee;
				padding: 1rem;
				white-space: pre-wrap;
			}

			#result > pre {
				margin: 0;
			}

			label {
				display: block;
				margin-bottom: 0.5rem;
			}

			input[type="text"] {
				border: 1px solid #ccc;
				border-radius: 0.25rem;
				font-size: 1rem;
				padding: 0.5rem;
				width: 100%;
			}

			input[type="submit"] {
				background-color: #333;
				border: 1px solid #333;
				border-radius: 0.25rem;
				color: #fff;
				cursor: pointer;
				font-size: 1rem;
				padding: 0.5rem;
				width: 100%;
			}

			input[type="submit"]:hover {
				background-color: #444;
				border-color: #444;
			}
			#logo {
				width: 100%;
				max-width: 400px;
			}
		</style>
	</head>
	<body>
		<div class="container" id="header">
			<h1>Jungle Vision</h1>
			<img src="logo.png" alt="" id="logo" />
			<p>View transaction details on the BSV Blockchain with Jungle Bus</p>
		</div>
		<div class="container" id="txform">
			<form action="index.php" method="get">
				<label for="txid">Transaction ID</label>
				<input type="text" name="txid" id="txid" />
				<input type="submit" value="Submit" />
			</form>
		</div>
		<!-- address form -->
		<div class="container" id="addressform">
			<form action="index.php" method="get">
				<label for="address">Address</label>
				<input type="text" name="address" id="address" />
				<input type="submit" value="Submit" />
			</form>
		</div>
		<!-- media results -->
		<div class="container" id="mediaResults"></div>
		<div class="container" id="result"></div>
		<script>
			const getTxidInfo = async (txid) => {
				const response = await fetch(
					`https://junglebus.gorillapool.io/v1/transaction/get/${txid}`
				);
				const data = await response.json();
				return data;
			};

			const getTxidInfoAndRender = async (txid) => {
				const data = await getTxidInfo(txid);
				const { transaction, contexts } = data;
				console.log(contexts);
				let base64 = transaction;
				// if contexts array includes a mime type of image, video, or audio, render the media
				const mediaTypes = ["image", "video", "audio"];
				// contexts might include "image/jpeg", "video/mp4", "audio/mpeg and others
				// if contexts includes "image/jpeg" or "image/png" render the image
				// if contexts includes "video/mp4" render the video
				// if contexts includes "audio/mpeg" render the audio
				//check all contexts and render the media
				//check if context includes anything with "/" and render the media
				const mediaResults = document.getElementById("mediaResults");
				mediaResults.innerHTML = "";
				contexts.forEach((context) => {
					let contextType = context.split("/")[0];
					if (mediaTypes.includes(contextType)) {
						if (contextType === "image") {
							contextType = "img";
						}
						const media = document.createElement(contextType);
						media.setAttribute("controls", "");
						media.setAttribute("src", `data:${context};base64,${base64}`);
						const dataurl = `data:${context};base64,${base64}`;
						console.log(dataurl);
						// set the width of the media to 100%
						media.style.width = "100%";

						mediaResults.appendChild(media);
					}
				});

				const result = document.getElementById("result");
				result.innerHTML = JSON.stringify(data, null, 2);
			};

			const urlParams = new URLSearchParams(window.location.search);
			const txid = urlParams.get("txid");
			if (txid) {
				getTxidInfoAndRender(txid);
			}

			const form = document.getElementById("txform");
			form.addEventListener("submit", (event) => {
				event.preventDefault();
				const txid = document.getElementById("txid").value;
				getTxidInfoAndRender(txid);
			});

			// https://junglebus.gorillapool.io/v1/address/get/{address}
			const getAddressInfo = async (address) => {
				const response = await fetch(
					`https://junglebus.gorillapool.io/v1/address/get/${address}`
				);
				const data = await response.json();
				return data;
			};

			const getAddressInfoAndRender = async (address) => {
				const data = await getAddressInfo(address);
				const result = document.getElementById("result");
				result.innerHTML = JSON.stringify(data, null, 2);
			};

			const urlParams2 = new URLSearchParams(window.location.search);
			const address = urlParams2.get("address");
			if (address) {
				getAddressInfoAndRender(address);
			}

			const form2 = document.getElementById("addressform");
			form2.addEventListener("submit", (event) => {
				event.preventDefault();
				const address = document.getElementById("address").value;
				getAddressInfoAndRender(address);
			});

			// GET /v1/address/transactions/:address	Get the transaction document for all transactions associated with the given address
			// const getAddressInfo2 = async (address) => {
			// 	const response = await fetch(
			// 		`https://junglebus.gorillapool.io/v1/address/transactions/${address}`
			// 	);
			// 	const data = await response.json();
			// 	return data;
			// };

			// const getAddressInfoAndRender2 = async (address) => {
			// 	const data = await getAddressInfo2(address);
			// 	const result = document.getElementById("result");
			// 	result.innerHTML = JSON.stringify(data, null, 2);
			// };

			// const urlParams3 = new URLSearchParams(window.location.search);
			// const address2 = urlParams3.get("address");
			// if (address2) {
			// 	getAddressInfoAndRender2(address2);
			// }
		</script>
	</body>
</html>
